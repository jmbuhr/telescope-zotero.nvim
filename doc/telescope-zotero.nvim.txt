*telescope-zotero.nvim.txt*  For Neovim >= 0.9.5  Last change: 2025 October 20

==============================================================================
Table of Contents                    *telescope-zotero.nvim-table-of-contents*

1. telescope-zotero.nvim         |telescope-zotero.nvim-telescope-zotero.nvim|
  - Requirements    |telescope-zotero.nvim-telescope-zotero.nvim-requirements|
  - Setup                  |telescope-zotero.nvim-telescope-zotero.nvim-setup|
  - Supported filetypes|telescope-zotero.nvim-telescope-zotero.nvim-supported-filetypes|
  - Demo                    |telescope-zotero.nvim-telescope-zotero.nvim-demo|
  - Inspiration      |telescope-zotero.nvim-telescope-zotero.nvim-inspiration|
2. Links                                         |telescope-zotero.nvim-links|

==============================================================================
1. telescope-zotero.nvim         *telescope-zotero.nvim-telescope-zotero.nvim*

List references from your local Zotero <https://www.zotero.org/> library and
add them to a bib file.



This does **not** provide autompletion in the document itself, as this is
handled by https://github.com/jmbuhr/cmp-pandoc-references for entries already
in `references.bib`. The intended workflow separates already used references
from new ones imported from Zotero via this new plugin.


REQUIREMENTS        *telescope-zotero.nvim-telescope-zotero.nvim-requirements*

- Zotero <https://www.zotero.org/>
- Better Bib Tex <https://retorque.re/zotero-better-bibtex/>


SETUP                      *telescope-zotero.nvim-telescope-zotero.nvim-setup*

Add to your telescope config, e.g. in lazy.nvim

>lua
    {
      'nvim-telescope/telescope.nvim',
      dependencies = {
        -- your other telescope extensions
        -- ...
        {
          'jmbuhr/telescope-zotero.nvim',
          dependencies = {
            { 'kkharji/sqlite.lua' },
          },
          -- options:
          -- to use the default opts:
          opts = {},
          -- to configure manually:
          -- config = function
          --   require'zotero'.setup{ <your options> }
          -- end,
        },
      },
      config = function()
        local telescope = require 'telescope'
        -- other telescope setup
        -- ...
        telescope.load_extension 'zotero'
      end
    },
<

Default options:

>lua
    ---@type Zotero.Configuration
    {
      -- File system options
      zotero_db_path        = '~/Zotero/zotero.sqlite',
      better_bibtex_db_path = '~/Zotero/better-bibtex.sqlite',
      zotero_storage_path   = '~/Zotero/storage',
      pdf_opener            = nil,
      collection            = nil,
      on_selection          = nil,
    
      -- Picker options
      picker = {
        with_icons = true,
        hlgroups = {
          icons       = 'SpecialChar',
          author_date = 'Comment',
          title       = 'Title',
        },
      },
    
      -- Filetype options (refer to next section)
      ft = { ... }
    }
<


SUPPORTED FILETYPES*telescope-zotero.nvim-telescope-zotero.nvim-supported-filetypes*

`telescope-zotero.nvim` supports formatting and references detection for the
following filetypes:

  ------------------------------------------------------------------------------------------
  Filetype           Format                           Reference (fallback)
  ------------------ -------------------------------- --------------------------------------
  Quarto             bibliography: <path>             N/A

  AsciiDoc           :bibliography-database: <path>   references.bib
                     or :bibtex-file: <path>          

  TeX/LaTeX          \bibliography{<path>} or         N/A
                     \addbibresource{<path>}          

  Typst              #bibliography(<path>)            references.bib

  Org                #+BIBLIOGRAPHY: <path> or        references.bib
                     #+bibliography: <path>           
  ------------------------------------------------------------------------------------------
For adding support for your filetype, you can add it to the `ft` table found in
the options. Entries in the table accept two parameters:

- `insert_key_formatter`, a function that converts a `citekey` into a citation.
- `locate_bib`, a function that locates the references bib file used in the current buffer.

For example, we can add support for `text` filetype as follows:

>lua
    opts = {
      fts = {
        text = {
          insert_key_formatter = function(citekey)
            return '[citation:' .. citekey .. ']'
          end,
          locate_bib = function()
            -- You function that locates the reference file in the current buffer
          end
        },
      },
    }
<

For adding support for a specific filetype, please open a PR request.

CUSTOM ACTIONS       *telescope-zotero.nvim-telescope-zotero.nvim-custom-actions*

Provide an `on_selection` callback to run custom logic every time an entry is
picked. The callback receives the full entry table. Returning a string inserts
that value. Returning a table lets you specify `insert_text` and optional
metadata such as a `note_path` that will be relayed via a notification. The
callback can be configured globally with `setup` or supplied per invocation by
passing `on_selection` in the picker options.

>lua
    require('zotero').setup {
      on_selection = function(entry)
        local note_dir = vim.fn.expand '~/Notes/Zotero'
        vim.fn.mkdir(note_dir, 'p')

        local title = entry.title or entry.citekey
        local authors = {}
        for _, creator in ipairs(entry.creators or {}) do
          if creator.lastName then
            local name = creator.lastName
            if creator.firstName then
              name = creator.firstName .. ' ' .. name
            end
            table.insert(authors, name)
          end
        end

        local note_path = string.format('%s/%s.md', note_dir, entry.citekey)
        local lines = {
          ('# %s (%s)'):format(title, entry.year or ''),
          '',
          ('- Authors: %s'):format(table.concat(authors, ', ')),
          ('- Citekey: %s'):format(entry.citekey),
          '',
          '## Summary',
          '',
        }
        vim.fn.writefile(lines, note_path)

        return {
          insert_text = '@' .. entry.citekey,
        note_path = note_path,
      }
    end,
  }
<

To keep the default picker unchanged and trigger the callback only for a
dedicated mapping, pass `on_selection` when calling the extension:

>lua
    local telescope = require 'telescope'

    vim.keymap.set('n', '<leader>fz', telescope.extensions.zotero.zotero, { desc = '[z]otero' })

    vim.keymap.set('n', '<leader>fn', function()
      telescope.extensions.zotero.zotero {
        on_selection = function(entry)
          local note_dir = vim.fn.expand '~/Notes/Zotero'
          vim.fn.mkdir(note_dir, 'p')

          local note_path = string.format('%s/%s.md', note_dir, entry.citekey)
          vim.fn.writefile({ '# ' .. (entry.title or entry.citekey) }, note_path)

          return {
            insert_text = '@' .. entry.citekey,
            note_path = note_path,
          }
        end,
      }
    end, { desc = 'Zotero note' })
<


DEMO                        *telescope-zotero.nvim-telescope-zotero.nvim-demo*

Video (https://www.youtube.com/watch?v=_o5SkTW67do):

<https://www.youtube.com/watch?v=_o5SkTW67do>


INSPIRATION          *telescope-zotero.nvim-telescope-zotero.nvim-inspiration*

This extension is inspired by the following plugins that all do an amazing job,
but not quite what I need. Depending on your needs, you should take a look at
those:

- zotcite <https://github.com/jalvesaq/zotcite> provides omnicompletion for zotero items in Quarto, Rmarkdown etc., but requires additional dependencies and uses a custom pandoc lua filter instead of a references.bib file
- zotex.nvim <https://github.com/tiagovla/zotex.nvim> is very close, but as a nvim-cmp completion source, which doesn’t fit
    with the intended separation of concerns.

Special Thanks to @kkharji for the `sqlite.lua` extension!

==============================================================================
2. Links                                         *telescope-zotero.nvim-links*

1. *Link to a YouTube video explaining the telescope-zotero extension*: https://img.youtube.com/vi/_o5SkTW67do/0.jpg
2. *@kkharji*: 

Generated by panvimdoc <https://github.com/kdheepak/panvimdoc>

vim:tw=78:ts=8:noet:ft=help:norl:
